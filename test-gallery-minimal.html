<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Test - Minimal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .gallery-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #f8981e;
        }
    </style>
</head>
<body>
    <h1>Gallery Test - Minimal Version</h1>
    <p>This page tests if the gallery API integration is working correctly.</p>

    <div class="test-section">
        <h2>Step 1: API Configuration</h2>
        <div id="config-test"></div>
    </div>

    <div class="test-section">
        <h2>Step 2: Fetch Gallery Images</h2>
        <div id="fetch-test"></div>
    </div>

    <div class="test-section">
        <h2>Step 3: Gallery Preview</h2>
        <div id="gallery-grid" class="gallery-grid"></div>
    </div>

    <!-- Load API Configuration -->
    <script src="api-config.js"></script>

    <!-- Test Script -->
    <script>
        console.log('=== Gallery Test Started ===');

        // Test 1: Check if API config is loaded
        const configTest = document.getElementById('config-test');

        if (typeof API_BASE_URL !== 'undefined' && typeof API_ENDPOINTS !== 'undefined') {
            configTest.innerHTML = `
                <p class="success">✓ API Configuration Loaded Successfully</p>
                <pre>API_BASE_URL: ${API_BASE_URL}
GALLERY_IMAGES endpoint: ${API_ENDPOINTS.GALLERY_IMAGES}
Hostname: ${window.location.hostname || '(empty - file protocol)'}
Protocol: ${window.location.protocol}</pre>
            `;
            console.log('✓ API_BASE_URL:', API_BASE_URL);
            console.log('✓ API_ENDPOINTS:', API_ENDPOINTS);
        } else {
            configTest.innerHTML = `
                <p class="error">✗ API Configuration Failed to Load</p>
                <p>API_BASE_URL defined: ${typeof API_BASE_URL !== 'undefined'}</p>
                <p>API_ENDPOINTS defined: ${typeof API_ENDPOINTS !== 'undefined'}</p>
            `;
            console.error('✗ API Configuration not loaded');
        }

        // Test 2: Fetch gallery images
        const fetchTest = document.getElementById('fetch-test');
        const galleryGrid = document.getElementById('gallery-grid');

        fetchTest.innerHTML = '<p class="info">⏳ Fetching images from API...</p>';

        async function testGalleryFetch() {
            try {
                const endpoint = API_ENDPOINTS.GALLERY_IMAGES;
                console.log('Fetching from:', endpoint);

                const response = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const images = await response.json();
                console.log('✓ Fetched', images.length, 'images');

                fetchTest.innerHTML = `
                    <p class="success">✓ Successfully fetched ${images.length} images from API</p>
                    <pre>Status: ${response.status} ${response.statusText}
Content-Type: ${response.headers.get('content-type')}
CORS Origin: ${response.headers.get('access-control-allow-origin') || 'Not set'}</pre>
                `;

                // Display images
                if (images.length > 0) {
                    galleryGrid.innerHTML = '';
                    images.slice(0, 12).forEach((img, idx) => {
                        const item = document.createElement('div');
                        item.className = 'gallery-item';

                        const imgEl = document.createElement('img');
                        imgEl.src = img.cloudinary_url;
                        imgEl.alt = img.caption || `Image ${idx + 1}`;
                        imgEl.title = `ID: ${img.id}\n${img.caption || 'No caption'}`;
                        imgEl.loading = 'lazy';

                        imgEl.onerror = function() {
                            console.error('Failed to load:', img.cloudinary_url);
                            this.style.border = '2px solid red';
                        };

                        imgEl.onload = function() {
                            console.log('✓ Loaded image:', idx + 1);
                        };

                        item.appendChild(imgEl);
                        galleryGrid.appendChild(item);
                    });

                    if (images.length > 12) {
                        const more = document.createElement('div');
                        more.style.gridColumn = '1 / -1';
                        more.style.textAlign = 'center';
                        more.style.padding = '20px';
                        more.innerHTML = `<p class="info">Showing 12 of ${images.length} images</p>`;
                        galleryGrid.appendChild(more);
                    }
                } else {
                    galleryGrid.innerHTML = '<p class="error">No images in database</p>';
                }

            } catch (error) {
                console.error('✗ Fetch failed:', error);
                fetchTest.innerHTML = `
                    <p class="error">✗ Failed to fetch images</p>
                    <pre>Error: ${error.message}

Endpoint: ${API_ENDPOINTS.GALLERY_IMAGES}

Troubleshooting:
1. Check if API is accessible: ${API_BASE_URL}/health
2. Open browser DevTools (F12) and check Console & Network tabs
3. Verify CORS headers allow this origin
4. Check if you're connected to the internet</pre>
                `;
                galleryGrid.innerHTML = '<p class="error">Could not load images</p>';
            }
        }

        // Run the test
        testGalleryFetch();
    </script>
</body>
</html>
